<!checkpoint>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script tsrc="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <title>Document</title>
    <style>
         #board {
            display: flex;
             flex-direction:column;
             align-items:center;
             
        }

        .input {
            width: 50px;
            height: 50px;
            text-align: center;
            margin: 0;
            padding: 0;
            font-size: 24px;
            font-weight: bold;
            border: 1px solid #ccc;
        }


        
        
        .level:nth-child(3n+1){
            border-top: 2px solid black;
        }
        .level:nth-child(9){
            border-bottom: 2px solid black;
        }

        .level .input:nth-child(1) {
            border-left: 3px solid black;
        }

        .level .input:nth-child(3n) {
            border-right: 3px solid black;
        }



        
        
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none; 
           
        }
        p{
            display: inline-block;
        }
        @media screen and (max-width: 480px) {
            input[type="number"] {
                width: 30px;  
                height: 30px; 
                font-size: 14px; 
                margin: 0;
            }
        }
    </style>
</head>
<body class="text-center">
    <h2 class="bg-success text-center">SUDOKU SOLVER</h2>
    <p class="error_Message text-danger"></p>
    <div id="board" class="mt-5">
        <div class="level">
            <input type="number" min="1" max="9" class="input row1col1">
            <input type="number" min="1" max="9" class="input row1col2">
            <input type="number" min="1" max="9" class="input row1col3">
            <input type="number" min="1" max="9" class="input row1col4">
            <input type="number" min="1" max="9" class="input row1col5">
            <input type="number" min="1" max="9" class="input row1col6">
            <input type="number" min="1" max="9" class="input row1col7">
            <input type="number" min="1" max="9" class="input row1col8">
            <input type="number" min="1" max="9" class="input row1col9">
        </div>
        <div class="level">
            <input type="number" min="1" max="9" class="input row2col1">
            <input type="number" min="1" max="9" class="input row2col2">
            <input type="number" min="1" max="9" class="input row2col3">
            <input type="number" min="1" max="9" class="input row2col4">
            <input type="number" min="1" max="9" class="input row2col5">
            <input type="number" min="1" max="9" class="input row2col6">
            <input type="number" min="1" max="9" class="input row2col7">
            <input type="number" min="1" max="9" class="input row2col8">
            <input type="number" min="1" max="9" class="input row2col9">
        </div>
        <div class="level">
            <input type="number" min="1" max="9" class="input row3col1">
            <input type="number" min="1" max="9" class="input row3col2">
            <input type="number" min="1" max="9" class="input row3col3">
            <input type="number" min="1" max="9" class="input row3col4">
            <input type="number" min="1" max="9" class="input row3col5">
            <input type="number" min="1" max="9" class="input row3col6">
            <input type="number" min="1" max="9" class="input row3col7">
            <input type="number" min="1" max="9" class="input row3col8">
            <input type="number" min="1" max="9" class="input row3col9">
        </div>
        <div class="level">
            <input type="number" min="1" max="9" class="input row4col1">
            <input type="number" min="1" max="9" class="input row4col2">
            <input type="number" min="1" max="9" class="input row4col3">
            <input type="number" min="1" max="9" class="input row4col4">
            <input type="number" min="1" max="9" class="input row4col5">
            <input type="number" min="1" max="9" class="input row4col6">
            <input type="number" min="1" max="9" class="input row4col7">
            <input type="number" min="1" max="9" class="input row4col8">
            <input type="number" min="1" max="9" class="input row4col9">
        </div>
        
        <div class="level">
            <input type="number" min="1" max="9" class="input row5col1">
            <input type="number" min="1" max="9" class="input row5col2">
            <input type="number" min="1" max="9" class="input row5col3">
            <input type="number" min="1" max="9" class="input row5col4">
            <input type="number" min="1" max="9" class="input row5col5">
            <input type="number" min="1" max="9" class="input row5col6">
            <input type="number" min="1" max="9" class="input row5col7">
            <input type="number" min="1" max="9" class="input row5col8">
            <input type="number" min="1" max="9" class="input row5col9">
        </div>
        <div class="level">
            <input type="number" min="1" max="9" class="input row6col1">
            <input type="number" min="1" max="9" class="input row6col2">
            <input type="number" min="1" max="9" class="input row6col3">
            <input type="number" min="1" max="9" class="input row6col4">
            <input type="number" min="1" max="9" class="input row6col5">
            <input type="number" min="1" max="9" class="input row6col6">
            <input type="number" min="1" max="9" class="input row6col7">
            <input type="number" min="1" max="9" class="input row6col8">
            <input type="number" min="1" max="9" class="input row6col9">
        </div>
        <div class="level">
            <input type="number" min="1" max="9" class="input row7col1">
            <input type="number" min="1" max="9" class="input row7col2">
            <input type="number" min="1" max="9" class="input row7col3">
            <input type="number" min="1" max="9" class="input row7col4">
            <input type="number" min="1" max="9" class="input row7col5">
            <input type="number" min="1" max="9" class="input row7col6">
            <input type="number" min="1" max="9" class="input row7col7">
            <input type="number" min="1" max="9" class="input row7col8">
            <input type="number" min="1" max="9" class="input row7col9">
        </div>
        
        <div class="level">
            <input type="number" min="1" max="9" class="input row8col1">
            <input type="number" min="1" max="9" class="input row8col2">
            <input type="number" min="1" max="9" class="input row8col3">
            <input type="number" min="1" max="9" class="input row8col4">
            <input type="number" min="1" max="9" class="input row8col5">
            <input type="number" min="1" max="9" class="input row8col6">
            <input type="number" min="1" max="9" class="input row8col7">
            <input type="number" min="1" max="9" class="input row8col8">
            <input type="number" min="1" max="9" class="input row8col9">
        </div>
        <div class="level">
            <input type="number" min="1" max="9" class="input row9col1">
            <input type="number" min="1" max="9" class="input row9col2">
            <input type="number" min="1" max="9" class="input row9col3">
            <input type="number" min="1" max="9" class="input row9col4">
            <input type="number" min="1" max="9" class="input row9col5">
            <input type="number" min="1" max="9" class="input row9col6">
            <input type="number" min="1" max="9" class="input row9col7">
            <input type="number" min="1" max="9" class="input row9col8">
            <input type="number" min="1" max="9" class="input row9col9">
        </div>

        <button class="btn btn-primary my-3 solvebtn">Solve</button>
    </div>

    <div>
        <p>Enter Youe Sudoku Board and Press Solve Button</p>
    </div>


    <script>
        var sudokuboard=[
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0]
        ];

        var user_invalid = [];
        const solvebttn = document.querySelector('.solvebtn');
        var inputboxes = document.querySelectorAll('.input');

        const error_message = document.querSelector('.error_Message');

        //Here the SudokuSolver code starts

        //This function is for finding the empty block in the board
        function findempty() {
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    if (sudokuboard[i][j] === 0) {
                        return [i, j];
                    }
                }
            }
            return [-1, -1];
        }


        //This function is to find find wether a fits in a specified blaock or not
        function isvalid(pos, num) {
            let [i, j] = pos;
            for (let c = 0; c < 9; c++) {
                if (j!=c && sudokuboard[i][c] === num) {
                    return false;
                }
                if (i!=c && sudokuboard[c][j] === num) {
                    return false;
                }
            }

            let box_row = Math.floor(i / 3) * 3;
            let box_column = Math.floor(j / 3) * 3;
            for (let r = box_row; r < box_row + 3; r++) {
                for (let c = box_column; c < box_column + 3; c++) {
                    if (sudokuboard[r][c] === num && r!=i && c!=j) {
                        return false;
                    }
                }
            }
            return true;
        }


        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }        

        
        //This is actual sudoku solving function
        async function sudokusolver(pos) {
            let [ei, ej] = findempty();
        
        
            if (ei === -1 && ej === -1) {
                return true;
            }
        
            for (let number = 1; number < 10; number++) {
                if (isvalid([ei, ej], number)) {
                    sudokuboard[ei][ej] = number;
                
                    document.querySelector(".row" + (ei + 1) + "col" + (ej + 1)).value = number;

                    await sleep(0.5);

                
                    if (await sudokusolver([ei, ej])) {
                        return true;
                    }
                
                    sudokuboard[ei][ej] = 0;
                }
            }
        
            return false;
        }


        //This function is for when enters input number does it valid in that block or not
        function verifyvalid(event){

            var input_value = parseInt(event.target.value);
            let row = parseInt(event.target.classList[1].slice(3,4),10)-1;
            let col = parseInt(event.target.classList[1].slice(-1),10)-1;
            sudokuboard[row][col]=input_value;

            if(!isvalid([row,col],input_value) || input_value>9){
                event.target.style.color = "red";
                if (!user_invalid.some(pos => pos[0] === row && pos[1] === col)) {
                    user_invalid.push([row, col]);
                }
                error_Message.innerHTML = "Each number from 1 to 9 must be used exactly once in each row, column, and 3x3 box within the grid.";
                

            }
            else{
                
                event.target.style.color = "black";
                user_invalid = user_invalid.filter(pos => !(pos[0] === row && pos[1] === col));
                

            }
        }

        let intervalid = setInterval(()=>{
            if(user_invalid.length==0){
                solvebttn.disabled=false;
            }
            else{
                solvebttn.disabled=true;
            }
        })

        
        

        

        //adding event listeners to each input tag

        inputboxes.forEach(
            (box)=>{
                box.addEventListener('keydown',replacefield);
                box.addEventListener('keyup',movenext);
                box.addEventListener('input',verifyvalid);

                
            }
        );

        //handling backspace and arrow buttons to navigate

        function replacefield(event){
            
            let current=event.target;
            let row = parseInt(current.classList[1].slice(3,4),10);
            let col = parseInt(current.classList[1].slice(-1),10);

            if(current.value.length >0 && event.keyCode>=48 && event.keyCode<=57){
                    current.value="";
                }

            else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (row > 1) {
                    row--;
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (row < 9) {
                    row++;
                }
            } else if (event.key === 'ArrowLeft') {
                event.preventDefault();
                if (col > 1) {
                    col--;
                }
            } else if (event.key === 'ArrowRight') {
                event.preventDefault();
                if (col < 9) {
                    col++;
                }
            }
            let classname = ".row"+row+"col"+col;
            let nextbox = document.querySelector(classname).focus();
        }

        // move to next cell if present cell is filled

        function movenext(event){
            let current = event.target;

            let row = parseInt(current.classList[1].slice(3,4),10);
            let col = parseInt(current.classList[1].slice(-1),10);


            if(event.keyCode===8 && current.value==="" && row*col>1){

                row = col===1?row-1:row;
                col = col===1?9:col-1;
                
            }
            else if(event.keyCode!=8 && row*col<81 && event.keyCode>=48 && event.keyCode<=57){
                
                row = col===9?row+1:row;
                col  = col==9?1:col+1;

            }

            let classname = ".row"+row+"col"+col;
            let nextbox = document.querySelector(classname).focus();

        }

        //submit button code disable inputs and save the inputs

        solvebttn.addEventListener('click',(event)=>{
            clearInterval(intervalid);

            let i=0;
            let j=0;

            inputboxes.forEach(
                (box)=>{
                    sudokuboard[i][j]=box.value.length>0?parseInt(box.value):0;
                    
                        if(sudokuboard[i][j]!=0){
                            box.style.backgroundColor = 'lightblue';

                        }
                        box.disabled=true;
                        j++;
                        if(j===9){
                            j=0;
                            i++;
                        }
                    
                }
            )
            event.target.disabled=true;
            start();
            
        });

        //starting function calls the sudokusolver function when button is clicked
        async function start(){
            
            
            if(await sudokusolver([0,0])){
                await sleep(100);
                alert("SOLVED");

            }
            else{
                console.log("Cant Solve");
                alert("UNSOLVABLE")
            }
        }



        

        

        
    </script>
    
</body>
</html>



